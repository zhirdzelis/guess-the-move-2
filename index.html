<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<title>Šahs vs Stockfish</title>

<link rel="stylesheet" href="chessboard.min.css">
<script src="chess.min.js"></script>
<script src="chessboard.min.js"></script>

<style>
body { font-family: sans-serif; padding: 20px; }
#eval { margin-top: 10px; font-size: 1.2em; }
</style>
</head>

<body>
<h2>Spēlē pret Stockfish</h2>
<div id="board" style="width: 400px;"></div>
<div id="eval">Tavs gājiens...</div>

<script>
// ====================
// Šaha loģika
// ====================
const game = new Chess();
const board = Chessboard('board', {
  draggable: true,
  position: 'start',
  onDrop: onDrop
});

// ====================
// Stockfish INIT
// ====================
const engine = new Worker("stockfish.js");
let engineReady = false;

engine.onmessage = function(e) {
  const line = e.data;

  if (line === "uciok") { engine.postMessage("isready"); return; }
  if (line === "readyok") { engineReady = true; console.log("Stockfish ready"); return; }

  if (line.startsWith("bestmove")) {
    const move = line.split(" ")[1];
    if (move === "(none)") return; // ja partija beigusies
    game.move({ from: move.slice(0,2), to: move.slice(2,4), promotion:'q' });
    board.position(game.fen());
    document.getElementById("eval").innerText = "Stockfish: " + move;
  }
};

// Sāk dzinēju
engine.postMessage("uci");

// ====================
// Funkcija lietotāja gājienam
// ====================
function onDrop(from, to) {
  const move = game.move({ from, to, promotion:'q' });
  if (!move) return 'snapback';

  board.position(game.fen());
  document.getElementById("eval").innerText = "Tavs gājiens: " + from + to;

  if (engineReady) {
    engine.postMessage("position fen " + game.fen());
    engine.postMessage("go depth 10"); // ātrs web demo, vari palielināt
  }
}
</script>
</body>
</html>
