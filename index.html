<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<title>Šahs vs Stockfish (teksta demo)</title>
<style>
body { font-family: sans-serif; padding: 20px; }
#log { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; background: #f9f9f9; }
input { padding: 5px; font-size: 1em; width: 80px; }
button { padding: 5px; font-size: 1em; }
</style>
</head>
<body>
<h2>Spēlē pret Stockfish</h2>
<div id="board" style="width: 400px;"></div>
<div id="eval">Tavs gājiens...</div>

<script>
const game = new Chess();
const board = Chessboard('board', {
  draggable: true,
  position: 'start',
  onDrop: onDrop
});

const engine = new Worker("stockfish.js");
let engineReady = false;

engine.onmessage = function(e) {
  const line = e.data;
  if(line === "uciok") { engine.postMessage("isready"); return; }
  if(line === "readyok") { engineReady = true; console.log("Stockfish ready"); return; }
  if(line.startsWith("bestmove")) {
      const move = line.split(" ")[1];
      game.move({from: move.slice(0,2), to: move.slice(2,4), promotion:'q'});
      board.position(game.fen());
      document.getElementById("eval").innerText = "Stockfish: " + move;
  }
};
engine.postMessage("uci");

function onDrop(from, to) {
  const move = game.move({from, to, promotion:'q'});
  if(!move) return 'snapback';
  board.position(game.fen());
  document.getElementById("eval").innerText = "Tavs gājiens: " + from + to;
  if(engineReady) {
      engine.postMessage("position fen " + game.fen());
      engine.postMessage("go depth 10");
  }
}
</script>
</body>
</html>

